/*!
 * cropme 1.0.0
 * https://shpontex.github.io/cropme
 * 
 * Copyright 2018 khereddine radhouane
 * Released under the MIT license
 * 
 */!function(e){var t={};function i(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(r,o,function(t){return e[t]}.bind(null,o));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";i.r(t),function(e){i(2);!function(t){const r=i(3);function o(){return"translate("+this.properties.x+"px,"+this.properties.y+"px) scale("+this.properties.scale+") rotate("+this.properties.deg+"deg)"}function s(){if(this.properties.rotation_slider)this.options.rotation.slider?this.properties.rotation_slider.disabled=!this.options.rotation.enable:(this.properties.wrapper.removeChild(this.properties.rotation_slider.parentNode),delete this.properties.rotation_slider);else if(this.options.rotation.slider){const e=document.createElement("div");e.classList.add("cropme-rotation-slider");const t=this.properties.rotation_slider=document.createElement("input");t.type="range",t.setAttribute("min",-180),t.setAttribute("max",180),t.setAttribute("step",1),t.value=0,t.style.width=this.options.container.width+"px",e.appendChild(t),this.properties.wrapper.appendChild(e);let i=this;this.properties.rotation_slider.addEventListener("input",function(e){i.rotate(e.target.value)}),this.properties.rotation_slider.disabled=!this.options.rotation.enable}}function n(){function e(){let e=this.options.container.width/2+12;"left"===this.options.rotation.position&&(e=-this.options.container.width/2-20);const t=this.options.container.height/2+12;this.properties.sliderContainer.style.transform="translate("+e+"px, "+t+"px) rotate(-90deg)",this.properties.sliderContainer.style.marginTop="-24px",this.properties.slider.disabled=!this.options.zoom.enable}if(this.properties.slider)this.options.zoom.slider?e.call(this):(this.properties.wrapper.removeChild(this.properties.slider.parentNode),delete this.properties.slider);else if(this.options.zoom.slider){let t=this;const i=this.properties.sliderContainer=document.createElement("div");i.classList.add("cropme-slider");const r=this.properties.slider=document.createElement("input");r.type="range",r.setAttribute("min",this.options.zoom.min),r.setAttribute("max",this.options.zoom.max),r.setAttribute("step",1e-6),r.style.width=this.options.container.width+"px",i.appendChild(r),this.properties.wrapper.insertBefore(i,this.properties.wrapper.firstChild),this.properties.slider.value=this.properties.scale,this.properties.slider.addEventListener("input",function(e){t.properties.scale=parseFloat(e.target.value),t.properties.image.style.transform=o.call(t)}),e.call(this)}}function p(){const e=this.properties.viewport=this.properties.viewport||document.createElement("div"),t=this.options;if(t.viewport.width=t.viewport.width>t.container.width?t.container.width:t.viewport.width,t.viewport.height=t.viewport.height>t.container.height?t.container.height:t.viewport.height,e.style.width=t.viewport.width+"px",e.style.height=t.viewport.height+"px",e.className="viewport","circle"===t.viewport.type&&(e.className="viewport circle"),t.viewport.border.enable){let e=(t.container.width-t.viewport.width)/2;t.viewport.border.width=e<t.viewport.border.width?e:t.viewport.border.width}else t.viewport.border.width=0;this.properties.viewport.style.borderWidth=t.viewport.border.width+"px",this.properties.viewport.style.borderColor=t.viewport.border.color,this.properties.container.appendChild(e)}function a(){(function(){const e=document.createElement("div");e.classList.add("cropme-container"),e.style.width=this.options.container.width+"px",e.style.height=this.options.container.height+"px",this.properties.container=e,this.properties.wrapper.appendChild(e)}).call(this),s.call(this),n.call(this),function(){this.properties.image||(this.properties.image=new Image),this.properties.image.ondragstart=(()=>!1),this.properties.container.appendChild(this.properties.image)}.call(this),p.call(this);let e,t,i=0,r=0,a=this,l=function(o){o.preventDefault();let s=o.pageX,n=o.pageY;o.touches&&(s=o.touches[0].pageX,n=o.touches[0].pageY),i=a.properties.x||i,r=a.properties.y||r,e=s-i,t=n-r,document.addEventListener("mousemove",h),document.addEventListener("touchmove",h),document.addEventListener("mouseup",c),document.addEventListener("touchend",c)};a.properties.image.addEventListener("mousedown",l),a.properties.image.addEventListener("touchstart",l);let h=function(i){i.preventDefault();let r=i.pageX,s=i.pageY;if(i.touches&&(r=i.touches[0].pageX,s=i.touches[0].pageY),i.touches&&i.touches.length>1){let e=i.touches[1],t=r-e.pageX,o=s-e.pageY;if(a.options.rotation.enable){let e=90-180*Math.atan2(t,o)/Math.PI;a.properties.odeg||(a.properties.odeg=e-a.properties.deg),a.properties.deg=e-a.properties.odeg}if(a.options.zoom.enable){let e=Math.sqrt(Math.pow(t,2)+Math.pow(o,2));a.properties.od||(a.properties.od=e/a.properties.scale),a.properties.scale=a.properties.slider.value=e/a.properties.od}}else a.properties.x=r-e,a.properties.y=s-t;a.properties.image.style.transform=o.call(a)},c=function(){document.removeEventListener("touchmove",h),document.removeEventListener("mousemove",h),document.removeEventListener("mouseup",c),document.removeEventListener("touchend",c),a.properties.od=0,a.properties.odeg=0;let e,t,i=a.properties.scale,r=a.properties.image.getBoundingClientRect(),o=a.properties.viewport.getBoundingClientRect(),s=o.top-r.top+o.height/2,n=o.left-r.left+o.width/2,p=a.properties.image.style.transformOrigin.split("px ");parseInt(p[0]),parseInt(p[1]),parseInt(a.properties.deg),Math.PI;e=n/i,t=s/i};a.properties.container.addEventListener("mousewheel",function(e){e.preventDefault();let t=a.properties.scale+e.wheelDelta/1200*a.properties.scale;t>a.options.zoom.min&&t<a.options.zoom.max&&a.options.zoom.mouseWheel&&a.options.zoom.enable&&(a.options.zoom.slider&&(a.properties.slider.value=t),a.properties.scale=t,a.properties.image.style.transform=o.call(a))})}window.jQuery&&(jQuery.fn.cropme=function(e,t){if("object"==typeof e)return this.each(function(){var t=new l(this,e);$(this).data("cropme",t)});if("string"!=typeof e)throw"Error: the argument must be an object or a string";{let i=this.data("cropme");switch(e){case"position":return i.position();case"bind":return i.bind(t);case"crop":return i.crop(t);case"rotate":return i.rotate(t);case"reload":return i.reload(t);case"destroy":return i.destroy();default:throw"Error: "+e+" method not found"}}});class l{constructor(e,t){if(e.className.indexOf("cropme-wrapper")>-1)throw"Error: Cropme is already initialized";this.properties={},this.options=r(h,t),this.properties.wrapper=e,"img"===e.tagName.toLowerCase()&&(this.properties.image=new Image,this.properties.image.src=e.src,this.properties.wrapper=document.createElement("div"),e.parentNode.insertBefore(this.properties.wrapper,e.previousSibling),e.parentNode.removeChild(e)),this.properties.wrapper.className+=" cropme-wrapper "+this.options.customClass,a.call(this),this.properties.image.src&&this.bind({url:this.properties.image.src})}bind(e){this.properties.image.src=e.url;let t=this.properties,i=this.options,r=this;return new Promise(s=>{this.properties.image.onload=function(){let n=t.image.getBoundingClientRect(),p=t.container.getBoundingClientRect(),a=(p.width-n.width)/2,l=(p.height-n.height)/2;t.ox=a,t.oy=l,"object"==typeof e.position&&(a=e.position.x||a,l=e.position.y||l);let h=e.scale?e.scale:p.height/n.height;if(i.zoom.max<=i.zoom.min)throw"Error: max zoom cannot be less or equal to min zoom";h<i.zoom.min&&(h=i.zoom.min),h>i.zoom.max&&(h=i.zoom.max),t.x=a,t.y=l,t.origin_x=n.width/2,t.origin_y=n.height/2,t.scale=h,r.options.zoom.slider&&(t.slider.value=h),t.deg=e.angle||0,t.image.style.transform=o.call(r),t.image.style.transformOrigin=function(e,t){return e+"px "+t+"px"}.call(r,t.origin_x,t.origin_y),t.image.style.opacity=1,s(r.properties.image)}})}rotate(e){this.properties.deg=e;let t=this.properties.image.style.transformOrigin.split("px "),i=parseInt(t[0]),r=parseInt(t[1]);this.properties.rotate_originx=i,this.properties.rotate_originy=r,this.properties.image.style.transform=o.call(this)}crop(e){let t=function(e){let t=document.createElement("canvas"),i=t.getContext("2d"),r=this.options.viewport.width,s=this.options.viewport.height;"object"==typeof e&&(e.scale?(r*=e.scale,s*=e.scale):e.width&&(s=e.width*s/r,r=e.width)),t.width=r,t.height=s;const n=r/this.options.viewport.width,p=s/this.options.viewport.height,a=this.properties.deg,l=this.properties.x,h=this.properties.y;function c(e,t,i){this.properties.deg=e,this.properties.x=t,this.properties.y=i,this.properties.image.style.transform=o.call(this)}0!==a&&c.call(this,0,this.properties.ox,this.properties.oy);const d=this.properties.image.getBoundingClientRect(),u=this.properties.viewport.getBoundingClientRect(),m=n*(d.x-u.x-this.options.viewport.border.width),f=p*(d.y-u.y-this.options.viewport.border.width);if(0!==a&&(i.translate((l-this.properties.x)*n,(h-this.properties.y)*p),i.translate(r/2,s/2),i.rotate(a*Math.PI/180),i.translate(-r/2,-s/2)),i.drawImage(this.properties.image,m,f,d.width*n,d.height*p),"circle"===this.options.viewport.type){i.translate(r/2,s/2),i.rotate(-a*Math.PI/180),i.translate(-r/2,-s/2),i.scale(1,this.options.viewport.height/this.options.viewport.width);let e=(this.options.viewport.width-this.options.viewport.height)/2*n,t=(this.properties.x-l)*n,o=(this.properties.y-h)*p;e>0?o=e+2*o:e<0&&(o=e+o/2),i.translate(t,o),i.globalCompositeOperation="destination-in",i.arc(r/2,s/2,r/2,0,2*Math.PI),i.fill()}return"triangle"===this.options.viewport.type&&(i.translate(r/2,s/2),i.rotate(-a*Math.PI/180),i.translate(-r/2,-s/2),i.translate((this.properties.x-l)*n,(this.properties.y-h)*p),i.beginPath(),i.globalCompositeOperation="destination-in",i.moveTo(r/2,0),i.lineTo(r,s),i.lineTo(0,s),i.closePath(),i.fill()),c.call(this,a,l,h),t}.call(this,e);return e="object"==typeof e?e.type:e,new Promise(i=>{"blob"===e?t.toBlob(e=>i(URL.createObjectURL(e))):i(t.toDataURL())})}position(){return{x:this.properties.x,y:this.properties.y,scale:this.properties.scale,deg:parseInt(this.properties.deg)}}reload(e){this.options=r(h,e),p.call(this),n.call(this),s.call(this)}destroy(){this.properties.wrapper.innerHTML="",this.properties.wrapper.className=this.properties.wrapper.className.replace("cropme-wrapper",""),delete this.options,delete this.properties}}const h={container:{width:300,height:300},viewport:{width:100,height:100,border:{enable:!0,width:2,color:"#fff"}},zoom:{min:.01,max:3,enable:!0,mouseWheel:!0,slider:!1},customClass:"",rotation:{slider:!1,enable:!0,position:"right"}};"object"==typeof e.exports?e.exports=l:"function"==typeof define&&i(4)?define([],function(){return l}):t.Cropme=l}(window)}.call(this,i(1)(e))},function(e,t){e.exports=function(e){if(!e.webpackPolyfill){var t=Object.create(e);t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),Object.defineProperty(t,"exports",{enumerable:!0}),t.webpackPolyfill=1}return t}},function(e,t,i){},function(e,t,i){e.exports=function(e){function t(r){if(i[r])return i[r].exports;var o=i[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){"use strict";function r(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=function e(t){for(var i=arguments.length,n=Array(i>1?i-1:0),p=1;p<i;p++)n[p-1]=arguments[p];if(!n.length)return t;var a=n.shift();if((0,o.isObject)(t)&&(0,o.isObject)(a))for(var l in a)(0,o.isObject)(a[l])?(t[l]||Object.assign(t,r({},l,{})),e(t[l],a[l])):(0,s.isArray)(a[l])?(t[l]||Object.assign(t,r({},l,[])),t[l]=t[l].concat(a[l])):Object.assign(t,r({},l,a[l]));return e.apply(void 0,[t].concat(n))};var o=i(1),s=i(2);e.exports=t.default},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.isObject=function(e){return e&&"object"===(void 0===e?"undefined":i(e))&&!Array.isArray(e)}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isArray=function(e){return e&&Array.isArray(e)}}])},function(e,t){(function(t){e.exports=t}).call(this,{})}]);